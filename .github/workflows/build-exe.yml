name: Build 0101 Exporter

on:
  push:
    branches: [ main ]
  # 新增：允许在 GitHub Actions 页面手动点击按钮触发构建
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        # 安装脚本需要的库：pandas, openpyxl, requests 以及打包工具 pyinstaller
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller pandas openpyxl requests

      - name: Build EXE
        # 【修改点】这里将目标文件改为了 0101.py
        # --name customer_exporter 意味着生成的 exe 叫 customer_exporter.exe
        run: |
          pyinstaller --onefile --clean --name customer_exporter "0101.py"

      - name: Upload EXE
        uses: actions/upload-artifact@v4
        with:
          name: customer_exporter_exe
          # 路径必须对应：dist/ + 上面设定的 name + .exe
          path: dist/customer_exporter.exe
